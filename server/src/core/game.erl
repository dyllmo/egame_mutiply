%%--------------------------------------------------------------------------------------------------------------
%% Author : wu_huidong@126.com
%% Created by : 吴惠冬
%% Description : 系统入口
%%--------------------------------------------------------------------------------------------------------------
-module(game).

-behaviour(supervisor).
-behaviour(application).

-export([
	start/0,			%%-----Application启动
	start/2,			%%-----Application启动调用
	stop/0,				%%-----Application停止
	stop/1,				%%-----Application停止调用
	prep_stop/1,		%%-----Application停止前调用
	restart/0			%%-----Application重启
]).

-export([init/1]).		%%-----总督程初始化

-export([
	start_child/1,		%%-----启动子进程
	stop_child/1,		%%-----停止子进程
	restart_child/1,	%%-----重启子进程
	delete_child/1		%%-----删除子进程
]).

-include("game.hrl").

%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% Application启动
%% @end
%%--------------------------------------------------------------------------------------------------------------
start () ->
	application:start(?APP_NAME).
    
%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% Application关闭
%% @end
%%--------------------------------------------------------------------------------------------------------------
stop () ->
    application:stop(?APP_NAME).

%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% Application重启
%% @end
%%--------------------------------------------------------------------------------------------------------------
restart () ->
    stop(),
    start().

%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% Application启动调用
%% @end
%%--------------------------------------------------------------------------------------------------------------
start (_Type, _Args) ->	
    Result = supervisor:start_link({local,?APP_NAME},?APP_NAME,[]),
	cluster:init(),
	start_child({glog,{glog,start_link,[]},worker}),
	start_child({prof,{prof,start_link,[]},worker}),
	start_child({reloader,{reloader,start_link,[]},worker}),
	main:start(lib_misc:get_env_int(tid,0)),
	Result.

%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% Application关闭调用
%% @end
%%--------------------------------------------------------------------------------------------------------------
stop (_State) -> 
	ok.
	
prep_stop (_State) ->
	main:stop(?TID),
	ok.
	
%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% 总督程初始化
%% @end
%%--------------------------------------------------------------------------------------------------------------
init ([]) ->
    {ok,{{one_for_one,10,10},[]}}.
	
%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% 启动子进程
%% @end
%%--------------------------------------------------------------------------------------------------------------
start_child ({Id, {M, F, A}, Type}) ->
	Spec = {Id,{M,F,A},permanent,16#FFFFFFFF,Type,[M]},
	{ok,_} = supervisor:start_child(?APP_NAME,Spec).
	
%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% 停止子进程
%% @end
%%--------------------------------------------------------------------------------------------------------------
stop_child (Id) ->
	supervisor:terminate_child(?APP_NAME,Id).
	
%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% 重启子进程
%% @end
%%--------------------------------------------------------------------------------------------------------------
restart_child (Id) ->
	stop_child(Id),
	supervisor:restart_child(?APP_NAME,Id).
	
%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% 删除子进程
%% @end
%%--------------------------------------------------------------------------------------------------------------
delete_child (Id) ->
	stop_child(Id),
	supervisor:delete_child(?APP_NAME,Id).