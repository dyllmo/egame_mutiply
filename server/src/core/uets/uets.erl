%%--------------------------------------------------------------------------------------------------------------
%% Author : wu_huidong@126.com
%% Created by : 吴惠冬
%% Description : 用户自定义ets
%%--------------------------------------------------------------------------------------------------------------
-module(uets).

-export([start/1]).		%%-----启动

-include("game.hrl").

%%-------------------------------------------------------------------------------------------------------------
%% @doc
%% 启动
%% @end
%%-------------------------------------------------------------------------------------------------------------
start (Type) ->
	timer:sleep(100),
	?INFOS("===================================================================~n"),
	?INFOS("uets start~n"),
	?INFOS("===================================================================~n"),
	create(Type),
	init(Type),
	?INFOS("uets finish~n"),
	?INFOS("===================================================================~n"),
	ok.
	
%%-------------------------------------------------------------------------------------------------------------
%% @doc
%% 创建表
%% @end
%%-------------------------------------------------------------------------------------------------------------
create (Type)->
	Module = uets_module(),
	CommonTabls = Module:common_tables() ,
	ServerTabls = Module:server_tables(Type),
	lists:foreach(
		fun({Table,KeyPos}) ->
			?INFOS("uets create : ~p start~n", [Table]),
			lib_ets:create(Table,set,KeyPos,public),
			?INFOS("uets create : ~p finish~n", [Table]),
			?INFOS("===================================================================~n")
		end,
		CommonTabls ++ ServerTabls
	),
	ok.
	
%%-------------------------------------------------------------------------------------------------------------
%% @doc
%% 初始化数据
%% @end
%%-------------------------------------------------------------------------------------------------------------
init (Type) ->
	?INFOS("uets init : ~p start~n", [Type]),
	Module = uets_module(),
	Module:common_init(),
	Module:server_init(Type),
	?INFOS("uets init : ~p finish~n", [Type]),
	?INFOS("===================================================================~n"),
	ok.
	
%%--------------------------------------------------------------------------------------------------------------
%% @doc
%% 管理模块
%% @end
%%--------------------------------------------------------------------------------------------------------------
uets_module () ->
	lib_misc:get_env_atom(uets_module,mod_uets).